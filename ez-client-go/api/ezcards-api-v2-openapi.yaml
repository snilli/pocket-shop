openapi: 3.0.3
info:
  title: EZ Cards API Reference V2
  description: B2B Digital Gift Cards Provider - API Reference V2
  version: 2.0.0
  contact:
    name: EZ Group
  license:
    name: Copyright © 2025 EZ Group. All rights reserved.

servers:
  - url: https://api.ezcards.io
    description: EZ Cards API
  - url: https://api.example.com
    description: Example (documentation)

tags:
  - name: Balances
    description: Balance information across currencies
  - name: Products
    description: Product listings and specifications
  - name: Orders
    description: Order creation and retrieval
  - name: Codes
    description: Redeem codes for orders
  - name: Exchange Rates
    description: EZ Rate (effective exchange rate) for currency pairs

security:
  - ApiKeyAuth: []
  - BearerAuth: []

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: x-api-key
      description: API key assigned to your account for service access.
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Bearer token to authenticate the API request.

  schemas:
    # =============================================================================
    # Schema usage (ใช้ร่วมกัน vs ใช้ที่เดียว):
    # - OrderResponse / OrderProductResponse → Create Bulk Order, Create Instant Order เท่านั้น
    #   (มี payWithCurrency, fxSummary, unitPriceOriginal)
    # - GetOrdersOrderResponse / OrderProductResponseGetOrders → Get Orders เท่านั้น
    #   (ไม่มีฟิลด์ด้านบน; ตัวอย่างมี ezOrderNumber แต่ตาราง schema ใน doc ไม่ระบุ)
    # - ProductResponse → Get Products เท่านั้น (catalog). Get Codes ใช้ GetCodesProductResponse
    # - MoneyResponse, OrderStatus ใช้ร่วมกันและ shape เหมือนกันทุก endpoint
    # =============================================================================

    # --- Common ---
    MoneyResponse:
      type: object
      required: [amount, currency]
      properties:
        amount:
          type: string
          description: The monetary amount.
        currency:
          type: string
          description: The currency of amount (ISO-4217).

    OrderStatus:
      type: string
      enum: [PROCESSING, COMPLETED, CANCELLED]
      description: |
        PROCESSING - The order is currently being processed.
        COMPLETED - The order has been completed successfully.
        CANCELLED - The order has been cancelled and will not be processed.

    # --- Get Balances ---
    BalanceResponse:
      type: object
      required: [balance, currency]
      properties:
        balance:
          type: string
          description: The balance amount.
        currency:
          type: string
          description: The 3-letter currency code (ISO-4217).

    BalancesResponseData:
      type: array
      items:
        $ref: '#/components/schemas/BalanceResponse'

    # --- Get Products ---
    ProductFormat:
      type: string
      enum: [D, P]
      description: D = Digital, P = Physical

    PriceResponse:
      type: object
      required: [price, fromQuantity]
      properties:
        price:
          type: string
          description: The price of the product.
        fromQuantity:
          type: integer
          description: The minimum quantity for which the price is applicable.
        toQuantity:
          type: integer
          nullable: true
          description: The maximum quantity for which the price is applicable (null indicates no limit).

    ProductResponse:
      type: object
      required: [sku, name, brand, types, format, currency, faceValue, percentageOffFaceValue, isInstantDeliverySupported, descriptions, instructions, termConditions, prices]
      properties:
        sku:
          type: string
          description: The Stock Keeping Unit identifier for the product.
        name:
          type: string
          description: The name of the product.
        brand:
          type: string
          description: The brand of the product.
        brandCategory:
          type: string
          nullable: true
          description: The category of the brand.
        brandSubCategory:
          type: string
          nullable: true
          description: The sub-category of the brand.
        types:
          type: array
          items:
            type: string
          description: List of product types.
        format:
          $ref: '#/components/schemas/ProductFormat'
        country:
          type: string
          nullable: true
          description: The country for which the product is available.
        currency:
          type: string
          description: The 3-letter currency code (ISO-4217).
        imageUrl:
          type: string
          nullable: true
          description: The URL of the image representing the product.
        prices:
          type: array
          items:
            $ref: '#/components/schemas/PriceResponse'
        faceValue:
          type: string
          description: The face value of the product.
        percentageOffFaceValue:
          type: string
          description: The percentage off the face value of the product.
        isInstantDeliverySupported:
          type: boolean
          description: Whether the CreateInstantOrder API can be used for instant order and fulfillment.
        descriptions:
          type: array
          items:
            type: string
        instructions:
          type: array
          items:
            type: string
        termConditions:
          type: array
          items:
            type: string

    PaginationResponse:
      type: object
      required: [total, page, pageSize, totalPage, items]
      properties:
        total:
          type: integer
          description: Total number of items available.
        page:
          type: integer
          description: Current page number.
        pageSize:
          type: integer
          description: Number of items per page.
        totalPage:
          type: integer
          description: Total number of pages available.
        items:
          type: array
          items: {}
          description: List of items on the current page (type varies by endpoint).

    ProductsPaginationResponse:
      allOf:
        - $ref: '#/components/schemas/PaginationResponse'
        - type: object
          properties:
            items:
              type: array
              items:
                $ref: '#/components/schemas/ProductResponse'

    OrdersPaginationResponse:
      allOf:
        - $ref: '#/components/schemas/PaginationResponse'
        - type: object
          properties:
            items:
              type: array
              items:
                $ref: '#/components/schemas/GetOrdersOrderResponse'
              description: List of orders (Get Orders schema; no payWithCurrency/fxSummary/unitPriceOriginal).

    # --- Create Bulk Order / Create Instant Order / Get Orders ---
    ProductRequest:
      type: object
      required: [sku, quantity]
      properties:
        sku:
          type: string
          description: The Stock Keeping Unit identifier for the product.
        quantity:
          type: integer
          description: The quantity of the product requested in the order.

    # Product in order response (Create Bulk Order & Create Instant Order only – has unitPriceOriginal, FX)
    OrderProductResponse:
      type: object
      required: [sku, quantity, unitPrice, totalPrice, status]
      properties:
        sku:
          type: string
          description: The SKU of the product.
        quantity:
          type: integer
          description: The quantity of the product (always 1 for Instant orders).
        unitPriceOriginal:
          allOf:
            - $ref: '#/components/schemas/MoneyResponse'
          nullable: true
          description: Unit price in the product's native currency before FX. Only in Create Bulk Order / Create Instant Order responses; omitted when same-currency.
        unitPrice:
          $ref: '#/components/schemas/MoneyResponse'
        totalPrice:
          $ref: '#/components/schemas/MoneyResponse'
        status:
          $ref: '#/components/schemas/OrderStatus'

    # Product in order (Get Orders only – doc has no unitPriceOriginal/payWithCurrency/fxSummary)
    OrderProductResponseGetOrders:
      type: object
      required: [sku, quantity, unitPrice, totalPrice, status]
      properties:
        sku:
          type: string
          description: The SKU of the product.
        quantity:
          type: integer
          description: The quantity of the product.
        unitPrice:
          allOf:
            - $ref: '#/components/schemas/MoneyResponse'
          description: The unit price of the product.
        totalPrice:
          allOf:
            - $ref: '#/components/schemas/MoneyResponse'
          description: The total price of the product.
        status:
          $ref: '#/components/schemas/OrderStatus'

    FxEntry:
      type: object
      required: [pair, rate, asOfDate]
      properties:
        pair:
          type: string
          description: Currency pair used (e.g., EUR/USD).
        rate:
          type: number
          description: Applied FX rate for the pair.
        asOfDate:
          type: string
          description: ISO date/time when the rate was effective.

    # Order response for Create Bulk Order & Create Instant Order (has payWithCurrency, fxSummary, product.unitPriceOriginal)
    OrderResponse:
      type: object
      required: [transactionId, clientOrderNumber, grandTotal, createdAt, status, products]
      properties:
        transactionId:
          type: string
          description: The transaction identifier.
        clientOrderNumber:
          type: string
          description: The client's order number.
        payWithCurrency:
          type: string
          description: The currency used to settle/charge the order (Create Bulk/Instant only).
        grandTotal:
          $ref: '#/components/schemas/MoneyResponse'
        createdAt:
          type: string
          format: date-time
          description: Timestamp of when the order was created.
        status:
          $ref: '#/components/schemas/OrderStatus'
        products:
          type: array
          items:
            $ref: '#/components/schemas/OrderProductResponse'
        fxSummary:
          allOf:
            - type: array
              nullable: true
              items:
                $ref: '#/components/schemas/FxEntry'
          description: Summary of FX pairs/rates when cross-currency conversion is applied. Omitted for same-currency orders.

    # Order response for Get Orders only (doc: no payWithCurrency, no fxSummary, product has no unitPriceOriginal)
    GetOrdersOrderResponse:
      type: object
      required: [transactionId, clientOrderNumber, grandTotal, createdAt, status, products]
      properties:
        transactionId:
          type: string
          description: The transaction identifier.
        clientOrderNumber:
          type: string
          description: The client's order number.
        ezOrderNumber:
          type: string
          description: EZ order number. Appears in doc example only; not listed in schema table.
        grandTotal:
          allOf:
            - $ref: '#/components/schemas/MoneyResponse'
          description: The grand total amount and currency.
        createdAt:
          type: string
          format: date-time
          description: Timestamp of when the order was created.
        status:
          $ref: '#/components/schemas/OrderStatus'
        products:
          allOf:
            - type: array
              items:
                $ref: '#/components/schemas/OrderProductResponseGetOrders'
          description: List of products in the order.

    CreateBulkOrderRequest:
      type: object
      required: [products]
      properties:
        clientOrderNumber:
          type: string
          description: The order number assigned by the client, used for tracking and reference purposes.
        enableClientOrderNumberDupCheck:
          type: boolean
          default: false
          description: Enable to prevent duplicate clientOrderNumber.
        products:
          type: array
          items:
            $ref: '#/components/schemas/ProductRequest'
          description: List of products included in the order.
        payWithCurrency:
          type: string
          description: |
            Settlement currency (ISO-4217). Required only when the product currency is not in the customer's balance currencies.
            If omitted and product currency is in balances, system defaults to product currency.

    CreateInstantOrderRequest:
      type: object
      required: [sku]
      properties:
        clientOrderNumber:
          type: string
          description: The order number assigned by the client, used for tracking and reference purposes.
        enableClientOrderNumberDupCheck:
          type: boolean
          default: false
          description: Enable to prevent duplicate clientOrderNumber.
        sku:
          type: string
          description: The Stock Keeping Unit identifier for the product.
        payWithCurrency:
          type: string
          description: |
            Settlement currency (ISO-4217). Required only when the product currency is not in the customer's balance currencies.

    # --- Get Codes ---
    CodeStatus:
      type: string
      enum: [PROCESSING, COMPLETED]

    CodeResponse:
      type: object
      required: [stockId, status]
      properties:
        stockId:
          type: integer
          description: The unique identifier of the stock.
        status:
          $ref: '#/components/schemas/CodeStatus'
        redeemCode:
          type: string
          nullable: true
          description: The redeemable code for the product (can be null if not available).
        pinCode:
          type: integer
          nullable: true
          description: The PIN code for the product (can be null if not available).

    GetCodesProductResponse:
      type: object
      required: [sku, quantity, codes]
      properties:
        sku:
          type: string
          description: The SKU of the product.
        quantity:
          type: integer
          description: The quantity of the product.
        codes:
          type: array
          items:
            $ref: '#/components/schemas/CodeResponse'
          description: List of codes in the product.

    # --- Get Exchange Rates ---
    ExchangeRate:
      type: object
      required: [pair, base, quote, rate]
      properties:
        pair:
          type: string
          description: Currency pair in BASEQUOTE format (e.g., USDCAD).
        base:
          type: string
          description: Base currency (ISO-4217).
        quote:
          type: string
          description: Quote currency (ISO-4217).
        rate:
          type: string
          description: EZ Rate with 4 decimal places (e.g., "1.4102").

    ExchangeRatesPayload:
      type: object
      required: [updatedAt, productCurrencies, rates]
      properties:
        updatedAt:
          type: string
          format: date-time
          description: ISO-8601 timestamp of the latest rate update (UTC).
        productCurrencies:
          type: array
          items:
            type: string
          description: Platform-supported currencies (ISO-4217).
        rates:
          type: array
          items:
            $ref: '#/components/schemas/ExchangeRate'
          description: List of EZ Rates for currency pairs.

    # --- Generic envelope ---
    RequestIdEnvelope:
      type: object
      required: [requestId]
      properties:
        requestId:
          type: string
          description: Unique identifier assigned to each request for tracking purposes.

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          example: UNSUPPORTED_CURRENCY
        message:
          type: string
          example: payWithCurrency is required or not supported for this account.
        clientOrderNumber:
          type: string
          example: "1234"

paths:
  /v2/balances:
    get:
      tags: [Balances]
      summary: Get Balances
      description: Provide access to balance information across various currencies.
      operationId: getBalances
      parameters:
        - name: currency
          in: query
          required: false
          schema:
            type: string
            description: Optional filter by 3-letter currency code (ISO-4217).
          description: Optional filter for balance information by currency.
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/RequestIdEnvelope'
                  - type: object
                    required: [data]
                    properties:
                      data:
                        $ref: '#/components/schemas/BalancesResponseData'
              example:
                requestId: c4c7b997-79a5-4bde-9f17-47ad7eac9ed4
                data:
                  - balance: "10000.00"
                    currency: USD
                  - balance: "5000.00"
                    currency: CAD
        '400':
          description: Bad Request
        '500':
          description: Internal Server Error

  /v2/products:
    get:
      tags: [Products]
      summary: Get Products
      description: Retrieve detailed listings of products, including specifications, pricing, availability, and other critical information.
      operationId: getProducts
      parameters:
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 1000
            description: The number of items to be shown per page.
        - name: page
          in: query
          required: false
          schema:
            type: integer
            default: 1
            description: Page number to retrieve.
        - name: sku
          in: query
          required: false
          schema:
            type: string
          description: Optional filter for listing products by their SKU (e.g. 8PX-UF-Y5U,TTR-WI-YWN).
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/RequestIdEnvelope'
                  - type: object
                    required: [data]
                    properties:
                      data:
                        $ref: '#/components/schemas/ProductsPaginationResponse'
              example:
                requestId: c4c7b997-79a5-4bde-9f17-47ad7eac9ed4
                data:
                  total: 2
                  page: 1
                  pageSize: 10
                  totalPage: 1
                  items: []
        '400':
          description: Bad Request
        '500':
          description: Internal Server Error

  /v2/orders:
    get:
      tags: [Orders]
      summary: Get Orders
      description: Retrieve an order list with pagination support. Use it to check the latest status of specific orders.
      operationId: getOrders
      parameters:
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 10
            description: The number of items to be shown per page.
        - name: page
          in: query
          required: false
          schema:
            type: integer
            default: 1
            description: Page number to retrieve.
        - name: transactionId
          in: query
          required: false
          schema:
            type: string
          description: Optional filter by transaction id for order lookups.
        - name: clientOrderNumber
          in: query
          required: false
          schema:
            type: string
          description: Optional filter by clientOrderNumber for order lookups.
      responses:
        '200':
          description: OK - The list of orders is returned successfully.
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/RequestIdEnvelope'
                  - type: object
                    required: [data]
                    properties:
                      data:
                        $ref: '#/components/schemas/OrdersPaginationResponse'
        '400':
          description: Bad Request - The request was invalid, often due to incorrect query parameters.
        '500':
          description: Internal Server Error

    post:
      tags: [Orders]
      summary: Create Bulk Order
      description: |
        Create a new bulk order by specifying products and quantities. Operates asynchronously; fulfillment occurs subsequently.
        One API order can only contain products in a single currency.
      operationId: createBulkOrder
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateBulkOrderRequest'
            example:
              clientOrderNumber: po-1234
              products:
                - sku: TTR-WI-YWN
                  quantity: 1
                - sku: ELX-BF-85S
                  quantity: 1
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/RequestIdEnvelope'
                  - type: object
                    required: [data]
                    properties:
                      data:
                        $ref: '#/components/schemas/OrderResponse'
        '400':
          description: Bad Request
        '409':
          description: Conflict (e.g., duplicate clientOrderNumber when duplication check is enabled)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: CLIENT_ORDER_NUMBER_DUPLICATE
                clientOrderNumber: "1234"
        '422':
          description: Unprocessable Entity (e.g., invalid or missing payWithCurrency when required)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: UNSUPPORTED_CURRENCY
                message: payWithCurrency is required or not supported for this account.
        '500':
          description: Internal Server Error

  /v2/orders/instant:
    post:
      tags: [Orders]
      summary: Create Instant Order
      description: |
        Create a new order with exactly one product and quantity of one per request. The API will immediately attempt fulfillment.
        Returns COMPLETED if in stock (codes available via Get Codes), or PROCESSING if fulfilled asynchronously (poll order status).
      operationId: createInstantOrder
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateInstantOrderRequest'
            example:
              clientOrderNumber: "1234"
              sku: 8PX-UF-Y5U
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/RequestIdEnvelope'
                  - type: object
                    required: [data]
                    properties:
                      data:
                        $ref: '#/components/schemas/OrderResponse'
        '400':
          description: Bad Request
        '409':
          description: Conflict (e.g., duplicate clientOrderNumber when duplication check is enabled)
        '422':
          description: Unprocessable Entity (e.g., invalid or missing payWithCurrency when required)
        '500':
          description: Internal Server Error

  /v2/orders/{transactionId}/codes:
    get:
      tags: [Codes]
      summary: Get Codes
      description: Fetch codes that are ready for use within specific orders. Codes become available progressively as the order is fulfilled.
      operationId: getCodes
      parameters:
        - name: transactionId
          in: path
          required: true
          schema:
            type: string
          description: Unique identifier of the transaction to retrieve codes for.
        - name: sku
          in: query
          required: false
          schema:
            type: string
          description: Optional filter by product SKU.
        - name: stockIds
          in: query
          required: false
          schema:
            type: string
          description: Optional filter by list of EZ stock identifiers.
      responses:
        '200':
          description: OK - The codes associated with the specified order are returned successfully.
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/RequestIdEnvelope'
                  - type: object
                    required: [data]
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/GetCodesProductResponse'
              example:
                requestId: c4c7b997-79a5-4bde-9f17-47ad7eac9ed4
                data:
                  - sku: 8PX-UF-Y5U
                    quantity: 100
                    codes:
                      - stockId: 1
                        status: COMPLETED
                        redeemCode: J72D-I83E-N87F-213E-B980-K915
                        pinCode: 1234
                      - stockId: 2
                        status: PROCESSING
                        redeemCode: null
                        pinCode: null
        '400':
          description: Bad Request
        '404':
          description: Not Found - The specified codes could not be found.
        '500':
          description: Internal Server Error

  /v2/exchange-rates:
    get:
      tags: [Exchange Rates]
      summary: Get Exchange Rates
      description: Provide access to the latest EZ Rate (effective exchange rate) for supported currency pairs. Only the EZ Rate is returned; market rates and internal buffers are not exposed.
      operationId: getExchangeRates
      parameters:
        - name: pairs
          in: query
          required: false
          schema:
            type: string
          description: Comma-separated list of currency pairs. Each pair is 6 letters in BASEQUOTE ISO-4217 format (e.g., USDCAD,USDEUR,GBPEUR). If provided, base and quote are ignored.
        - name: base
          in: query
          required: false
          schema:
            type: string
          description: Filter by base currency (ISO-4217), e.g. USD. Ignored if pairs is provided.
        - name: quote
          in: query
          required: false
          schema:
            type: string
          description: Filter by quote currency (ISO-4217), e.g. CAD. Ignored if pairs is provided.
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/RequestIdEnvelope'
                  - type: object
                    required: [data]
                    properties:
                      data:
                        $ref: '#/components/schemas/ExchangeRatesPayload'
              example:
                requestId: b2b3f3c5-1e3a-4a3a-9df0-7b2f3c9b6b11
                data:
                  updatedAt: "2025-10-03T04:00:07Z"
                  productCurrencies: [USD, CAD, EUR, GBP]
                  rates:
                    - pair: USDCAD
                      base: USD
                      quote: CAD
                      rate: "1.4102"
                    - pair: USDEUR
                      base: USD
                      quote: EUR
                      rate: "0.8610"
        '400':
          description: Bad Request
        '401':
          description: Unauthorized
        '500':
          description: Internal Server Error
